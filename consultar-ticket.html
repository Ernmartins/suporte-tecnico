<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>SmartHelp ‚Äì Consultar Ticket</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<nav class="top-nav">
  <a href="index.html">Abrir ticket</a>
  <a href="consultar-ticket.html">Consultar ticket</a>
  <a href="login.html">Login t√©cnico</a>
  <a href="dashboard.html">Dashboard</a>
</nav>

<div class="container">
  <h1>üîç Consultar Ticket</h1>
  <p class="subtitle">Introduza o ID do ticket para ver o estado</p>

  <label>Introduza o ID do Ticket</label>
  <input type="text" id="ticketID" placeholder="Ex: TCK-0004">

  <button onclick="procurar()">Procurar</button>

  <div id="resultado" style="margin-top:20px;"></div>
</div>

<script type="module">
  import { firebaseConfig } from "./firebase.js";

  import { 
    initializeApp 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

  import { 
    getFirestore, collection, getDocs 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  window.procurar = async function () {
    const id  = document.getElementById("ticketID").value.trim();
    const div = document.getElementById("resultado");

    if (!id) {
      div.innerHTML = "<p style='color:red;'>Introduza um ID.</p>";
      return;
    }

    div.innerHTML = "A procurar...";

    const snap = await getDocs(collection(db, "tickets"));

    let encontrado = null;
    snap.forEach(doc => {
      if (doc.data().id === id) encontrado = doc.data();
    });

    if (!encontrado) {
      div.innerHTML = "<p style='color:red;'>‚ùå Ticket n√£o encontrado.</p>";
      return;
    }

    div.innerHTML = `
      <h3>Resultado</h3>
      <p><b>ID:</b> ${encontrado.id}</p>
      <p><b>Nome:</b> ${encontrado.nome}</p>
      <p><b>Estado:</b> ${encontrado.estado}</p>
      <p><b>Categoria:</b> ${encontrado.categoria}</p>
      <p><b>Prioridade:</b> ${encontrado.prioridade}</p>
      <p><b>Descri√ß√£o:</b> ${encontrado.descricao}</p>
    `;
  };
</script>

</body>
</html>
