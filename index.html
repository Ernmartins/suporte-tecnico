<script type="module">
import { firebaseConfig } from "./firebase.js";

import { 
  initializeApp 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

import { 
  getFirestore, collection, addDoc, getDocs 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("ticketForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  // 1) Buscar número atual de tickets
  const snap = await getDocs(collection(db, "tickets"));
  const total = snap.size + 1;

  // 2) Criar ID automático formatado
  const ticketID = "TCK-" + String(total).padStart(4, '0');

  // 3) Guardar no Firestore
  await addDoc(collection(db, "tickets"), {
    id: ticketID,
    nome: nome.value,
    email: email.value,
    telefone: telefone.value,
    categoria: categoria.value,
    prioridade: prioridade.value,
    descricao: descricao.value,
    estado: "Aberto",
    data: new Date()
  });

  alert("Ticket enviado com sucesso!\nO seu ID é: " + ticketID);

  document.getElementById("ticketForm").reset();
});
</script>

